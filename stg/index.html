<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>CDC Slot Booking</title>
    <script src="https://telegram.org/js/telegram-web-app.js?59"></script>
    <script src="tailwind-3.4.17.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tg-bg': 'var(--tg-theme-bg-color, #ffffff)',
                        'tg-text': 'var(--tg-theme-text-color, #000000)',
                        'tg-hint': 'var(--tg-theme-hint-color, #999999)',
                        'tg-button': 'var(--tg-theme-button-color, #3390ec)',
                        'tg-button-text': 'var(--tg-theme-button-text-color, #ffffff)',
                        'tg-secondary-bg': 'var(--tg-theme-secondary-bg-color, #f0f0f0)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-tg-bg text-tg-text px-4 pt-1 pb-24 overflow-x-hidden h-screen flex flex-col font-[system-ui,-apple-system,BlinkMacSystemFont,'Segoe_UI',Roboto,Helvetica,Arial,sans-serif]">
    <div class="container max-w-2xl mx-auto flex-1 flex flex-col overflow-hidden">
        <div id="loading" class="text-center py-10 text-tg-hint">
            Loading...
        </div>

        <div id="error" class="hidden bg-red-50 text-red-700 p-3 rounded-lg mb-4 text-sm"></div>

        <div id="app" class="hidden">
            <!-- View Selector -->
            <div class="flex gap-0 mb-2 bg-tg-secondary-bg rounded-lg p-1">
                <button class="view-btn flex-1 py-2 px-3 border-0 rounded-md !bg-tg-bg !text-tg-text shadow-sm text-sm font-semibold cursor-pointer transition-all duration-200" data-view="slots">Slots</button>
                <button class="view-btn flex-1 py-2 px-3 border-0 rounded-md bg-transparent text-tg-hint text-sm font-semibold cursor-pointer transition-all duration-200" data-view="options">Options</button>
            </div>

            <!-- Slots View -->
            <div id="slots-view" class="pb-4">
                <div class="mb-6">
                    <div class="flex items-center gap-3 mb-1 text-base font-semibold">
                        <span class="flex-1">Select Slots</span>
                        <div class="flex items-center gap-1 text-[10px] text-tg-hint">
                            <span>Demand:</span>
                            <span class="text-[9px]">Low</span>
                            <div class="w-16 h-3 rounded-sm bg-gradient-to-r from-[rgba(244,67,54,0.05)] to-[rgba(244,67,54,0.70)]"></div>
                            <span class="text-[9px]">High</span>
                        </div>
                    </div>
                    
                    <div class="text-[11px] text-tg-hint">
                        Red shading shows how many users want each slot.
                    </div>
                    
                    <div class="text-[11px] text-tg-hint mb-2">
                        Tap table headers or "Date" to inverse selections.
                    </div>

                    <!-- Month Navigation -->
                    <div class="flex justify-between items-center mb-2 p-3 bg-tg-secondary-bg rounded-lg">
                        <button class="py-1.5 px-3 border-0 bg-tg-button text-tg-button-text rounded-md text-sm font-medium cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed active:opacity-80" id="prev-month-btn">← Prev</button>
                        <div class="text-lg font-semibold text-tg-text" id="current-month-title">October 2025</div>
                        <button class="py-1.5 px-3 border-0 bg-tg-button text-tg-button-text rounded-md text-sm font-medium cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed active:opacity-80" id="next-month-btn">Next →</button>
                    </div>

                    <!-- Slot Matrix Table -->
                    <table class="slot-matrix w-full border-collapse bg-tg-bg rounded-lg shadow-sm [border-spacing:0] [table-layout:fixed]" id="slot-matrix">
                        <thead class="block w-full">
                            <tr class="table w-full [table-layout:fixed]">
                                <th class="date-column p-1.5 text-center border border-tg-secondary-bg bg-tg-secondary-bg font-semibold text-[10px] text-tg-text sticky top-0 z-10 cursor-pointer select-none hover:bg-tg-hint/20 w-[45px] min-w-[45px] text-left pl-1" id="toggle-all-header" title="Click to toggle all slots in this month">Date</th>
                                <!-- Time slot headers will be dynamically inserted -->
                            </tr>
                        </thead>
                        <tbody id="matrix-body" class="block w-full max-h-[calc(100vh-340px)] overflow-y-auto overflow-x-hidden">
                            <!-- Rows will be dynamically inserted -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Options View -->
            <div id="options-view" class="hidden pb-4">
                <div class="mb-6">
                    <div class="text-base font-semibold mb-3">Monitoring Options</div>
                    
                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Stop After One Slot</div>
                            <div class="text-xs text-tg-hint mt-1">End monitoring after booking one slot</div>
                        </div>
                        <div class="toggle-switch relative w-[50px] h-7 bg-gray-300 rounded-full cursor-pointer transition-colors" data-option="stop_after_one_slot">
                            <div class="toggle-slider absolute w-6 h-6 bg-white rounded-full top-0.5 left-0.5 transition-transform duration-300"></div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Stop at Midnight</div>
                            <div class="text-xs text-tg-hint mt-1">End monitoring at end of day</div>
                        </div>
                        <div class="toggle-switch relative w-[50px] h-7 bg-gray-300 rounded-full cursor-pointer transition-colors" data-option="stop_at_midnight">
                            <div class="toggle-slider absolute w-6 h-6 bg-white rounded-full top-0.5 left-0.5 transition-transform duration-300"></div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Back-To-Back Only</div>
                            <div class="text-xs text-tg-hint mt-1">Only book if adjacent to existing slots</div>
                        </div>
                        <div class="toggle-switch relative w-[50px] h-7 bg-gray-300 rounded-full cursor-pointer transition-colors" data-option="back_to_back_only">
                            <div class="toggle-slider absolute w-6 h-6 bg-white rounded-full top-0.5 left-0.5 transition-transform duration-300"></div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Ignore Today's Slots</div>
                            <div class="text-xs text-tg-hint mt-1">Don't book lessons held today</div>
                        </div>
                        <div class="toggle-switch relative w-[50px] h-7 bg-gray-300 rounded-full cursor-pointer transition-colors" data-option="exclude_current_day">
                            <div class="toggle-slider absolute w-6 h-6 bg-white rounded-full top-0.5 left-0.5 transition-transform duration-300"></div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Daily Lesson Limit</div>
                            <div class="text-xs text-tg-hint mt-1">Max lessons you would take in a single day</div>
                        </div>
                        <div class="relative">
                            <select id="daily-lesson-limit" class="py-2 pr-8 pl-3 border-0 rounded-lg bg-tg-bg text-tg-text text-sm cursor-pointer appearance-none">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                            <span class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-[10px] text-tg-hint">▼</span>
                        </div>
                    </div>

                    <div class="flex justify-between items-center p-3 bg-tg-secondary-bg rounded-lg mb-2">
                        <div>
                            <div class="text-sm font-medium">Priority Mode</div>
                            <div class="text-xs text-tg-hint mt-1">Credits per booking (higher = better priority)</div>
                        </div>
                        <div class="relative">
                            <select id="credits-per-slot" class="py-2 pr-8 pl-3 border-0 rounded-lg bg-tg-bg text-tg-text text-sm cursor-pointer appearance-none">
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                            <span class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-[10px] text-tg-hint">▼</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Footer -->
    <div class="fixed bottom-0 left-0 right-0 bg-tg-bg border-t border-tg-secondary-bg p-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)] z-[100]">
        <div class="max-w-2xl mx-auto">
            <button class="w-full py-3.5 border-0 rounded-lg bg-tg-button text-tg-button-text text-base font-semibold cursor-pointer active:opacity-80" id="confirm-btn">Confirm All Changes</button>
            <div class="text-[11px] text-tg-hint text-center mt-1.5">Changes only saved when confirmed.</div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
